<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VIREX ELITE | The Blood Database</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Orbitron:wght@400;900&family=Poppins:wght@300;600;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --blood: #ff0000;
            --blood-dark: #660000;
            --dark: #020202;
            --panel: #0a0a0a;
            --neon-glow: 0 0 15px rgba(255, 0, 0, 0.7);
        }

        /* --- ANİMASYONLU ARKA PLAN --- */
        @keyframes bgMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(-45deg, #050505, #1a0000, #000000, #2a0000);
            background-size: 400% 400%;
            animation: bgMove 15s ease infinite;
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }

        /* --- AUTH WALL --- */
        #auth-wall {
            position: fixed; inset: 0; z-index: 10000;
            background: rgba(0,0,0,0.98); display: flex; align-items: center; justify-content: center;
        }

        .auth-card {
            background: var(--panel); padding: 40px; border-radius: 25px;
            border: 2px solid var(--blood); box-shadow: var(--neon-glow);
            width: 450px; position: relative;
        }

        input {
            width: 100%; padding: 15px; margin: 10px 0; background: #000;
            border: 1px solid #333; color: #fff; border-radius: 10px;
        }

        .file-label {
            display: block; padding: 15px; border: 2px dashed var(--blood-dark);
            margin: 10px 0; cursor: pointer; border-radius: 10px; text-align: center; font-size: 12px;
        }

        /* --- APP INTERFACE --- */
        nav {
            height: 80px; background: rgba(0,0,0,0.9); border-bottom: 2px solid var(--blood);
            display: none; align-items: center; justify-content: space-between; padding: 0 50px;
            position: fixed; top: 0; width: 100%; z-index: 1000;
        }

        #app-container { display: none; margin-top: 80px; height: calc(100vh - 80px); }
        .grid-layout { display: grid; grid-template-columns: 320px 1fr 320px; height: 100%; }

        .sidebar { background: #050505; padding: 25px; border-right: 1px solid #1a1a1a; overflow-y: auto; }
        .stage { background: #000; display: flex; flex-direction: column; overflow: hidden; }
        
        .video-grid { flex: 1; display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; padding: 30px; }
        .user-box { background: #0d0d0d; border-radius: 20px; border: 2px solid #222; position: relative; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: cover; }

        .mic-active {
            position: absolute; top: 20px; right: 20px; width: 45px; height: 45px;
            background: var(--blood); border-radius: 50%; display: none;
            align-items: center; justify-content: center; box-shadow: 0 0 20px var(--blood);
            animation: pulse 0.6s infinite alternate; z-index: 10;
        }
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.2); } }

        /* DISCORD PROFILE CARD */
        .dc-card { background: #18191c; border-radius: 15px; overflow: hidden; }
        .dc-banner { height: 100px; background: linear-gradient(to right, #660000, #ff0000); }
        .dc-avatar-wrap { margin-top: -50px; padding: 0 20px; position: relative; display: inline-block; }
        .dc-avatar { width: 100px; height: 100px; border-radius: 50%; border: 6px solid #18191c; background: #000; object-fit: cover; }
        .dc-frame { position: absolute; top: -14px; left: 6px; width: 128px; pointer-events: none; }

        .btn { padding: 12px 20px; border: none; border-radius: 10px; font-family: 'Orbitron'; cursor: pointer; transition: 0.3s; }
        .btn-blood { background: var(--blood); color: #fff; }
        
        /* FRAME SHOP GRID */
        .frame-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-height: 400px; overflow-y: auto; padding: 10px; }
        .frame-item { background: #1a1a1a; padding: 10px; border-radius: 10px; cursor: pointer; border: 2px solid transparent; }
        .frame-item:hover { border-color: var(--blood); transform: scale(1.05); }

    </style>
</head>
<body>

    <div id="auth-wall">
        <div class="auth-card">
            <h1 style="font-family: 'Black Ops One'; color: var(--blood); font-size: 40px; text-align: center;">VIREX</h1>
            <div id="auth-toggle" style="display: flex; gap: 10px; margin: 20px 0;">
                <button class="btn" onclick="setAuthMode('login')" style="flex:1; background:#222; color:#fff;">GİRİŞ</button>
                <button class="btn" onclick="setAuthMode('reg')" style="flex:1; background:#222; color:#fff;">KAYIT</button>
            </div>

            <div id="login-form">
                <input type="text" id="l-user" placeholder="Kullanıcı Adı">
                <input type="password" id="l-pass" placeholder="Şifre">
                <button class="btn btn-blood" style="width: 100%;" onclick="doLogin()">SİSTEME SIZ</button>
            </div>

            <div id="reg-form" style="display: none;">
                <input type="text" id="r-user" placeholder="Kullanıcı Adı">
                <input type="password" id="r-pass" placeholder="Şifre">
                <label class="file-label">
                    <input type="file" id="r-pp" hidden onchange="savePP(this)">
                    <i class="fas fa-image"></i> Profil Fotoğrafı Seç
                </label>
                <button class="btn btn-blood" style="width: 100%;" onclick="doRegister()">KAYIT OL</button>
            </div>
        </div>
    </div>

    <nav id="navbar">
        <div class="logo">VIREX<span>ELITE</span></div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <span id="nav-name" style="font-weight: 900;">USER#0001</span>
            <img id="nav-pp" src="" style="width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--blood); object-fit: cover;">
        </div>
    </nav>

    <div id="app-container">
        <div class="grid-layout">
            <aside class="sidebar">
                <button class="btn btn-blood" style="width: 100%; margin-bottom: 20px;" onclick="createLobby()">LOBİ KUR</button>
                <div id="lobby-list">
                    <div style="background:#111; padding:15px; border-radius:10px; border-left:4px solid var(--blood); margin-bottom:10px;">
                        <h4 style="color:var(--blood)">Virex HQ Main</h4>
                        <p style="font-size:10px; color:#555;">Online: 128</p>
                    </div>
                </div>
            </aside>

            <main class="stage">
                <div class="video-grid" id="videoGrid">
                    <div class="user-box">
                        <video id="localCam" autoplay playsinline muted></video>
                        <div class="mic-active" id="micGlow"><i class="fas fa-microphone"></i></div>
                        <div style="position: absolute; bottom: 20px; left: 20px; background: rgba(0,0,0,0.8); padding: 8px 15px; border-radius: 8px;">
                            <span id="video-tag-name" style="font-weight: 900; color: var(--blood);">PLAYER</span>
                        </div>
                    </div>
                </div>
                <div style="height: 100px; background: #050505; display: flex; align-items: center; justify-content: center; gap: 20px;">
                    <button class="btn btn-blood" style="border-radius:50%; width:60px; height:60px;" onclick="toggleAudio()"><i class="fas fa-microphone"></i></button>
                    <button class="btn btn-blood" style="border-radius:50%; width:60px; height:60px;" onclick="toggleVideo()"><i class="fas fa-video"></i></button>
                    <button class="btn btn-blood" onclick="shareScreen()">EKRAN PAYLAŞ</button>
                </div>
            </main>

            <aside class="sidebar" style="border-left: 1px solid #1a1a1a;">
                <div class="dc-card">
                    <div class="dc-banner"></div>
                    <div class="dc-avatar-wrap">
                        <img id="profile-pp" class="dc-avatar" src="https://i.imgur.com/6VBx3io.png">
                        <img id="profile-frame" class="dc-frame" src="">
                    </div>
                    <div style="padding: 20px;">
                        <h2 id="profile-name" style="font-family: 'Orbitron'; font-size: 18px;">KULLANICI</h2>
                        <p style="color:var(--blood); font-size:11px; font-weight:900;">MASTER CHEATER</p>
                        <hr style="border: 0; border-top: 1px solid #222; margin: 15px 0;">
                        <button class="btn" style="width: 100%; background: #222; color: #fff; font-size: 10px; margin-bottom: 10px;" onclick="openFrameShop()">ÇERÇEVE MAĞAZASI</button>
                        <button class="btn" style="width: 100%; background: #400; color: #fff; font-size: 10px;" onclick="doLogout()">HESAPTAN ÇIKIŞ YAP</button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        let tempPP = "";
        let localStream = null;

        // --- AUTH MODU ---
        function setAuthMode(mode) {
            document.getElementById('login-form').style.display = (mode === 'login') ? 'block' : 'none';
            document.getElementById('reg-form').style.display = (mode === 'reg') ? 'block' : 'none';
        }

        // --- KAYIT OL ---
        function doRegister() {
            const user = document.getElementById('r-user').value;
            const pass = document.getElementById('r-pass').value;
            if(!user || !pass) return Swal.fire('Hata','Boş bırakma koçum!','error');
            
            const db = JSON.parse(localStorage.getItem('virex_db') || '{}');
            db[user] = { pass: pass, pp: tempPP };
            localStorage.setItem('virex_db', JSON.stringify(db));
            
            Swal.fire('Başarılı','Kayıt tamam, giriş yapabilirsin!','success');
            setAuthMode('login');
        }

        // --- GİRİŞ YAP ---
        function doLogin() {
            const user = document.getElementById('l-user').value;
            const pass = document.getElementById('l-pass').value;
            const db = JSON.parse(localStorage.getItem('virex_db') || '{}');

            if(db[user] && db[user].pass === pass) {
                sessionStorage.setItem('active_user', JSON.stringify({ name: user, pp: db[user].pp }));
                enterApp();
            } else {
                Swal.fire('Hata','Kullanıcı bulunamadı veya şifre yanlış!','error');
            }
        }

        // --- ÇIKIŞ YAP ---
        function doLogout() {
            sessionStorage.clear();
            location.reload();
        }

        // --- UYGULAMAYA GİRİŞ ---
        async function enterApp() {
            const user = JSON.parse(sessionStorage.getItem('active_user'));
            if(!user) return;

            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('localCam').srcObject = localStream;
                
                document.getElementById('auth-wall').style.display = 'none';
                document.getElementById('navbar').style.display = 'flex';
                document.getElementById('app-container').style.display = 'block';

                document.getElementById('nav-name').innerText = user.name + "#0001";
                document.getElementById('profile-name').innerText = user.name.toUpperCase();
                document.getElementById('video-tag-name').innerText = user.name.toUpperCase();
                
                if(user.pp) {
                    document.getElementById('nav-pp').src = user.pp;
                    document.getElementById('profile-pp').src = user.pp;
                }

                detectVoice(localStream);
            } catch(e) {
                Swal.fire('İzin Şart','Kamera ve Mikrofon izni vermeden giremezsin!','error');
            }
        }

        // --- DOSYA OKU ---
        function savePP(input) {
            const reader = new FileReader();
            reader.onload = (e) => { tempPP = e.target.result; Swal.fire('Tamam','Fotoğraf yüklendi!','success'); };
            reader.readAsDataURL(input.files[0]);
        }

        // --- SES ALGILAMA ---
        function detectVoice(stream) {
            const audioCtx = new AudioContext();
            const analyser = audioCtx.createAnalyser();
            const source = audioCtx.createMediaStreamSource(stream);
            analyser.fftSize = 512;
            source.connect(analyser);
            const data = new Uint8Array(analyser.frequencyBinCount);

            function check() {
                analyser.getByteFrequencyData(data);
                let vol = data.reduce((a, b) => a + b) / data.length;
                document.getElementById('micGlow').style.display = (vol > 40) ? 'flex' : 'none';
                requestAnimationFrame(check);
            }
            check();
        }

        // --- DISCORD SHOP TÜM ÇERÇEVELER ---
        const frames = [
            { name: "Cyberpunk", url: "v2/a_8656113ccf3e24b7a66164f9f7403164.png" },
            { name: "Fantasy Blue", url: "v2/a_550220979667c31d17d096c466488344.png" },
            { name: "Fire Lord", url: "v2/a_b5104d498114c000df837c7682f6e520.png" },
            { name: "Glitcher", url: "v2/a_06f1556017006830500f4f9f53e344e5.png" },
            { name: "Lofi Cafe", url: "v2/a_6c4767142468305f884a0d9b4b96b467.png" },
            { name: "Horror Night", url: "v2/a_2069539369324151325.png" }
        ];

        function openFrameShop() {
            let html = `<div class="frame-grid">`;
            frames.forEach((f, index) => {
                html += `
                <div class="frame-item" onclick="setFrame('${f.url}')">
                    <img src="https://cdn.discordapp.com/avatar-decoration-presets/${f.url}" width="60">
                    <p style="font-size:10px; margin-top:5px;">${f.name}</p>
                </div>`;
            });
            html += `</div>`;
            
            Swal.fire({ title: 'Frame Shop', background: '#0a0a0a', color: '#fff', html: html, showConfirmButton: false });
        }

        function setFrame(url) {
            document.getElementById('profile-frame').src = "https://cdn.discordapp.com/avatar-decoration-presets/" + url;
            Swal.close();
        }

        // --- MEDYA ---
        function toggleAudio() { localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled; }
        function toggleVideo() { localStream.getVideoTracks()[0].enabled = !localStream.getVideoTracks()[0].enabled; }
        async function shareScreen() {
            const ss = await navigator.mediaDevices.getDisplayMedia({ video: true });
            const box = document.createElement('div');
            box.className = "user-box"; box.innerHTML = `<video id="sV" autoplay playsinline></video>`;
            document.getElementById('videoGrid').appendChild(box);
            document.getElementById('sV').srcObject = ss;
        }

        // Sayfa açıldığında giriş yapılmış mı kontrol et
        if(sessionStorage.getItem('active_user')) enterApp();

    </script>
</body>
</html>
