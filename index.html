<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VIREX ELITE | Authorized Access Only</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Poppins:wght@300;400;600;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --blood: #ff0000;
            --blood-glow: rgba(255, 0, 0, 0.6);
            --dark: #050505;
            --card-bg: #0d0d0d;
            --text: #ffffff;
            --discord: #5865F2;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark);
            color: var(--text);
            overflow-x: hidden;
        }

        /* --- LOGIN OVERLAY (WALL) --- */
        #login-gate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #200000 0%, #050505 100%);
            z-index: 9999; display: flex; align-items: center; justify-content: center;
        }

        .login-box {
            background: var(--card-bg); padding: 40px; border-radius: 20px;
            border: 2px solid var(--blood); box-shadow: 0 0 50px var(--blood-glow);
            text-align: center; width: 400px; animation: glow 2s infinite alternate;
        }

        @keyframes glow { from { box-shadow: 0 0 20px var(--blood-glow); } to { box-shadow: 0 0 40px var(--blood); } }

        .login-box input {
            width: 100%; padding: 12px; margin: 10px 0; background: #1a1a1a;
            border: 1px solid #333; color: white; border-radius: 8px;
        }

        /* --- NAVBAR --- */
        nav {
            position: fixed; top: 0; width: 100%; height: 80px;
            background: rgba(0,0,0,0.9); border-bottom: 2px solid var(--blood);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 5%; z-index: 1000; display: none; /* Login sonrası açılır */
        }

        .logo { font-family: 'Black Ops One'; font-size: 30px; color: var(--blood); }

        /* --- LOBBY SYSTEM --- */
        #lobby-container { display: none; padding-top: 80px; height: 100vh; }

        .lobby-layout { display: grid; grid-template-columns: 320px 1fr 320px; height: calc(100vh - 80px); }

        .sidebar { background: #080808; border-right: 1px solid #1a1a1a; padding: 20px; overflow-y: auto; }
        .main-stage { background: #000; position: relative; display: flex; flex-direction: column; }
        
        /* VIDEO GRID */
        .video-grid { flex: 1; display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 15px; padding: 20px; }
        .user-slot { 
            background: #111; border-radius: 15px; border: 2px solid #222; 
            position: relative; overflow: hidden; height: 100%; min-height: 250px;
        }
        .user-slot video { width: 100%; height: 100%; object-fit: cover; }

        /* MİKROFON İKONU (KONUŞMA EFEKTİ) */
        .voice-indicator {
            position: absolute; top: 15px; right: 15px; background: var(--blood);
            width: 35px; height: 35px; border-radius: 50%; display: none;
            align-items: center; justify-content: center; box-shadow: 0 0 15px var(--blood);
            animation: pulse 0.5s infinite alternate;
        }
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.2); } }

        /* PROFILE SECTION */
        .profile-area { background: #18191c; border-radius: 12px; overflow: hidden; position: relative; }
        .banner { height: 80px; background: var(--blood); }
        .avatar-wrap { margin-top: -45px; padding: 0 20px; position: relative; }
        .main-pp { 
            width: 90px; height: 90px; border-radius: 50%; border: 5px solid #18191c;
            background: #000; object-fit: cover;
        }
        .decoration-frame {
            position: absolute; top: -10px; left: 10px; width: 110px; 
            pointer-events: none; transition: transform 0.3s;
        }

        /* MODAL ANIMATION */
        .modal-body { text-align: center; background: #111; padding: 20px; border-radius: 15px; }
        .frame-selector { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .frame-item { border: 2px solid #333; padding: 5px; cursor: pointer; border-radius: 10px; }
        .frame-item:hover { border-color: var(--blood); transform: scale(1.1); }

        .store-item {
            background: #151515; padding: 20px; border-radius: 15px; border: 1px solid #222;
            text-align: center; margin-bottom: 20px; transition: 0.3s;
        }
        .store-item:hover { border-color: var(--blood); }
        .btn-blood {
            background: var(--blood); color: white; border: none; padding: 12px 25px;
            border-radius: 8px; font-weight: 800; cursor: pointer; transition: 0.3s;
        }
        .btn-blood:hover { transform: scale(1.05); filter: brightness(1.2); }

    </style>
</head>
<body>

    <div id="login-gate">
        <div class="login-box">
            <h1 style="font-family: 'Black Ops One'; color: var(--blood); margin-bottom: 20px;">VIREX ACCESS</h1>
            <p style="font-size: 13px; color: #888; margin-bottom: 20px;">Lobilere erişmek için giriş yapmalısınız.</p>
            <input type="text" id="username" placeholder="Kullanıcı Adı">
            <input type="password" id="password" placeholder="Şifre">
            <button class="btn-blood" style="width: 100%; margin-top: 10px;" onclick="doLogin()">GİRİŞ YAP</button>
        </div>
    </div>

    <nav id="top-nav">
        <div class="logo">VIREX<span>ELITE</span></div>
        <div style="display:flex; gap:30px; font-weight: 600;">
            <span style="color:var(--blood); cursor:pointer;">LOBİLER</span>
            <span style="color:#666; cursor:pointer;" onclick="Swal.fire('Mağaza','Yakında aktif!','info')">MAĞAZA</span>
        </div>
        <div id="user-tag" style="font-weight: 800; color: #fff;"></div>
    </nav>

    <div id="lobby-container">
        <div class="lobby-layout">
            <aside class="sidebar">
                <button class="btn-blood" style="width: 100%; margin-bottom: 20px;" onclick="createNewLobby()">+ LOBİ OLUŞTUR</button>
                <div id="lobby-list">
                    <div class="store-item" style="padding: 10px; text-align: left; cursor: pointer;" onclick="joinLobby('Virex Official CS2')">
                        <h4 style="color:var(--blood)">Virex Official CS2</h4>
                        <small>8 Oyuncu Bağlı</small>
                    </div>
                </div>
            </aside>

            <main class="main-stage">
                <div class="video-grid" id="videoGrid">
                    <div class="user-slot">
                        <video id="localVideo" autoplay playsinline muted></video>
                        <div class="voice-indicator" id="voiceIndicator">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <div style="position:absolute; bottom:10px; left:10px; background:rgba(0,0,0,0.7); padding:5px 12px; border-radius:5px; font-size:12px;">
                            SİZ (Canlı)
                        </div>
                    </div>
                </div>

                <div style="height: 100px; background: #080808; display: flex; align-items: center; justify-content: center; gap: 20px; border-top: 1px solid #222;">
                    <button class="btn-blood" style="background:#222;" id="micToggle" onclick="toggleMic()"><i class="fas fa-microphone"></i></button>
                    <button class="btn-blood" style="background:#222;" id="camToggle" onclick="toggleCam()"><i class="fas fa-video"></i></button>
                    <button class="btn-blood" onclick="startShare()"><i class="fas fa-desktop"></i> EKRAN PAYLAŞ</button>
                    <button class="btn-blood" style="background:var(--blood);" onclick="location.reload()">AYRIL</button>
                </div>
            </main>

            <aside class="sidebar" style="border-right:none; border-left:1px solid #1a1a1a;">
                <div class="profile-area">
                    <div class="banner"></div>
                    <div class="avatar-wrap">
                        <img src="https://media.tenor.com/y_S_m7T36m8AAAAM/anime-aesthetic.gif" class="main-pp" id="userPP">
                        <img src="https://cdn.discordapp.com/avatar-decoration-presets/v2/a_550220979667c31d17d096c466488344.png" class="decoration-frame" id="currentFrame">
                    </div>
                    <div style="padding: 20px;">
                        <h3 id="displayUsername" style="font-weight: 900;">Syvex#0001</h3>
                        <p style="font-size: 12px; color: #888; margin-top: 5px;">Virex Admin Access</p>
                        <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
                        <button class="btn-blood" style="width:100%; font-size: 11px;" onclick="openProfileSettings()">PROFİLİ DÜZENLE</button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        let localStream;
        let audioContext;
        let analyser;
        let microphone;

        // 1. GİRİŞ SİSTEMİ
        function doLogin() {
            const user = document.getElementById('username').value;
            if(user.length < 3) return Swal.fire('Hata','Geçerli bir isim gir koçum!','error');

            // Kamera ve Ses İzni İste
            navigator.mediaDevices.getUserMedia({ video: true, audio: true })
            .then(stream => {
                localStream = stream;
                document.getElementById('localVideo').srcObject = stream;
                
                // Login Başarılı
                document.getElementById('login-gate').style.display = 'none';
                document.getElementById('top-nav').style.display = 'flex';
                document.getElementById('lobby-container').style.display = 'block';
                document.getElementById('displayUsername').innerText = user + "#0001";
                document.getElementById('user-tag').innerText = user;

                // Ses Analizi Başlat (Mikrofon İkonu İçin)
                setupVoiceDetection(stream);
            })
            .catch(err => {
                Swal.fire('Erişim Reddedildi','Lobiye girmek için kamera ve mikrofon izni şart!','error');
            });
        }

        // 2. SES ALGILAMA (Mikrofon İkonu Animasyonu)
        function setupVoiceDetection(stream) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            microphone = audioContext.createMediaStreamSource(stream);
            analyser.fftSize = 512;
            microphone.connect(analyser);

            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            function checkVoice() {
                analyser.getByteFrequencyData(dataArray);
                let volume = 0;
                for(let i=0; i<dataArray.length; i++) { volume += dataArray[i]; }
                let average = volume / dataArray.length;

                // Eğer ses belli bir seviyenin üstündeyse ikon çıksın
                document.getElementById('voiceIndicator').style.display = (average > 30) ? 'flex' : 'none';
                requestAnimationFrame(checkVoice);
            }
            checkVoice();
        }

        // 3. PROFİL VE ÇERÇEVE DÜZENLEME (ANIMASYONLU)
        function openProfileSettings() {
            Swal.fire({
                title: 'Profilini Özelleştir',
                html: `
                    <div class="modal-body">
                        <input id="new-pp" class="swal2-input" placeholder="GIF / Resim URL" style="background:#222; color:#fff">
                        <h4 style="margin-top:20px; color:var(--blood)">Çerçeve Seç</h4>
                        <div class="frame-selector">
                            <div class="frame-item" onclick="setFrame('v2/a_550220979667c31d17d096c466488344.png')">
                                <img src="https://cdn.discordapp.com/avatar-decoration-presets/v2/a_550220979667c31d17d096c466488344.png" width="50">
                            </div>
                            <div class="frame-item" onclick="setFrame('v2/a_8656113ccf3e24b7a66164f9f7403164.png')">
                                <img src="https://cdn.discordapp.com/avatar-decoration-presets/v2/a_8656113ccf3e24b7a66164f9f7403164.png" width="50">
                            </div>
                            <div class="frame-item" onclick="setFrame('v2/a_2069539369324151325.png')">
                                <img src="https://cdn.discordapp.com/avatar-decoration-presets/v2/a_2069539369324151325.png" width="50">
                            </div>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Kaydet',
                background: '#0d0d0d',
                color: '#fff'
            }).then((result) => {
                const newPP = document.getElementById('new-pp').value;
                if(newPP) document.getElementById('userPP').src = newPP;
            });
        }

        function setFrame(path) {
            document.getElementById('currentFrame').src = "https://cdn.discordapp.com/avatar-decoration-presets/" + path;
            Swal.showValidationMessage('Çerçeve Seçildi!');
        }

        // 4. LOBİ İŞLEMLERİ
        function createNewLobby() {
            Swal.fire({
                title: 'Lobi Adı',
                input: 'text',
                background: '#111',
                color: '#fff',
                confirmButtonColor: '#ff0000'
            }).then(res => {
                if(res.value) {
                    const div = document.createElement('div');
                    div.className = 'store-item';
                    div.style = 'padding:10px; text-align:left; cursor:pointer;';
                    div.innerHTML = `<h4 style="color:var(--blood)">${res.value}</h4><small>1 Oyuncu Bağlı</small>`;
                    document.getElementById('lobby-list').prepend(div);
                }
            });
        }

        async function startShare() {
            try {
                const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });
                const box = document.createElement('div');
                box.className = 'user-slot';
                box.innerHTML = `<video id="screenVideo" autoplay playsinline></video><div style="position:absolute; top:10px; right:10px; background:var(--blood); padding:5px; border-radius:5px; font-size:10px;">EKRAN PAYLAŞILIYOR</div>`;
                document.getElementById('videoGrid').appendChild(box);
                document.getElementById('screenVideo').srcObject = screenStream;
            } catch(e) {}
        }

        let isMuted = false;
        function toggleMic() {
            isMuted = !isMuted;
            localStream.getAudioTracks()[0].enabled = !isMuted;
            document.getElementById('micToggle').innerHTML = isMuted ? '<i class="fas fa-microphone-slash"></i>' : '<i class="fas fa-microphone"></i>';
            document.getElementById('micToggle').style.color = isMuted ? 'red' : 'white';
        }

        let isVidOff = false;
        function toggleCam() {
            isVidOff = !isVidOff;
            localStream.getVideoTracks()[0].enabled = !isVidOff;
            document.getElementById('camToggle').innerHTML = isVidOff ? '<i class="fas fa-video-slash"></i>' : '<i class="fas fa-video"></i>';
            document.getElementById('camToggle').style.color = isVidOff ? 'red' : 'white';
        }

    </script>
</body>
</html>
